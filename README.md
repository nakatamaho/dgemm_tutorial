# DGEMM高速化チュートリアル
**Ryzen Threadripper 3970X特化：ナイーブ実装から1 TFLOPS級への道**

---

## 🎯 このチュートリアルについて

**DGEMM**（Double precision General Matrix Multiplication; 行列-行列積）をRyzen Threadripper 3970X上で最適化し、**ナイーブ実装から1000倍高速化**を実現する実践的チュートリアルです。

### なぜDGEMMか？
- 機械学習・科学計算の**心臓部**
- 高性能コンピューティング技術の**縮図**
- 最適化効果が**数値で明確**に見える

### なぜ3970X特化か？
CPU毎に最適化パラメータが大きく異なるため、汎用化より特化で確実な成果を目指します。筆者の

---

## 🕐 四コマ構成（180分講義 + 個人実習）

### 📋 基本方針
- **講義**: 理論・戦略の理解（実装なし）
- **個人実習**: GitHub自習で実際の実装
- **段階的習得**: 理論→戦略→基礎→応用

| コマ | 時間 | 内容 | 学習目標 | 成果物 |
|:---:|:---:|------|----------|---------|
| **1** | 45分 | 理論基盤 | なぜ最適化が必要か | 全体像理解 |
| **2** | 45分 | 実装戦略 | どう実装すべきか | 実装計画 |
| **3** | 45分 | 基礎実装 | 10-100倍高速化 | 基本技術習得 |
| **4** | 45分 | 応用技術 | 最先端への道筋 | 継続学習計画 |

---

## 🛤️ 学習パス選択

### 🟢 理解重視（45分）
**第1コマのみ** - 概念理解・動機形成
- 対象：DGEMM初心者
- 成果：最適化の必要性理解

### 🟡 実装準備（90分）  
**第1-2コマ** - 理論+実装戦略
- 対象：実装予定者
- 成果：具体的実装計画

### 🔴 完全習得（180分）
**全4コマ** - 理論から応用まで
- 対象：本格的な習得希望者
- 成果：1 TFLOPS実現への道筋

---

## 💻 ターゲット環境

### ✅ 推奨環境（動作保証）
- **CPU**: Ryzen Threadripper 3970X (32コア/64スレッド)
- **アーキテクチャ**: Zen2、AVX2対応
- **OS**: Linux (Ubuntu推奨)
- **コンパイラ**: GCC 9.0以上

### ⚠️ 重要な注意
- **3970X専用**: 他CPU（Intel等）では性能が出ない可能性
- **AVX512非対応**: 3970XはAVX2のみ対応
- **NUMA構成**: 32コアの効率的活用には注意が必要

---

## 📚 コンテンツ構成

### 第1コマ：理論基盤（45分）
| 章 | タイトル | 難易度 | 内容 |
|:---:|----------|:-----:|------|
| 1 | DGEMM基礎と重要性 | ☆☆☆ | 定義・重要性・3970Xの潜在能力 |
| 2 | 3970Xアーキテクチャ | ☆☆☆ | Zen2の特性・メモリ階層 |
| 9 | メモリ階層理論 | ★☆☆ | キャッシュ効率の重要性 |

### 第2コマ：実装戦略（45分）
| 章 | タイトル | 難易度 | 内容 |
|:---:|----------|:-----:|------|
| 4-5 | メモリ配置設計 | ★☆☆ | データ構造・アドレス計算 |
| 8 | デバッグ戦略 | ★☆☆ | 実装時のトラブル回避 |
| 新規 | 3970X最適化方針 | ★☆☆ | 段階的実装ロードマップ |

### 第3コマ：基礎実装（45分）
| 章 | タイトル | 難易度 | 内容 |
|:---:|----------|:-----:|------|
| 6 | ナイーブ実装 | ★☆☆ | 基本的3重ループ |
| 10 | キャッシュブロック化 | ★★☆ | L3最適化（簡易版） |
| 12-13 | マイクロカーネル基礎 | ★★☆ | レジスタ効率化 |

### 第4コマ：応用技術（45分）
| 章 | タイトル | 難易度 | 内容 |
|:---:|----------|:-----:|------|
| 18 | 32コア並列化 | ★★☆ | OpenMP・NUMA対応 |
| 16 | AVX2最適化概要 | ★★★ | SIMD活用（概要のみ） |
| 19-20 | 継続学習ガイド | ☆☆☆ | 上級技術への道筋 |

---

## 🚀 達成可能な性能目標

### 📊 段階別性能向上（3970X実測値）
| 段階 | 手法 | 性能 | 向上率 | 実装難易度 |
|:---:|------|:----:|:-----:|:---------:|
| 0 | ナイーブ実装 | 0.01 TFLOPS | 1倍 | ★☆☆ |
| 1 | キャッシュブロック化 | 0.1 TFLOPS | 10倍 | ★★☆ |
| 2 | AVX2活用 | 0.4 TFLOPS | 40倍 | ★★★ |
| 3 | 32コア並列 | 1.0 TFLOPS | 100倍 | ★★☆ |
| **最終** | **統合最適化** | **1.2 TFLOPS** | **120倍** | **★★★** |

### 🎯 最終目標
**Ryzen Threadripper 3970Xで1 TFLOPS超えの行列積実現**

---

## 🗂️ 自習用完全版（GitHub）

### 🔥 講義カバー範囲（★☆☆〜★★☆）
基礎理解・実装戦略・基本最適化

### 🚀 自習推奨（★★★）
| 章 | タイトル | 内容 | サポート |
|:---:|----------|------|----------|
| 14 | データパッキング | 転置・メモリ効率化 | 段階的ガイド |
| 15 | 3重ブロック化 | 階層最適化 | デバッグ支援 |
| 16-17 | AVX2実装詳細 | SIMD最適化 | サンプルコード |

### 📖 補助資料
Chapter 3, 7, 11, 17（実装例・ベンチマーク・比較分析）

---

## 🎓 前提知識と学習成果

### 📋 推奨前提知識
- **C/C++**: 中級レベル（ポインタ・配列操作）
- **線形代数**: 行列積の概念
- **Linux**: 基本的なコマンド操作

### 💡 習得できるスキル
- **3970X特化**: Zen2アーキテクチャの活用法
- **メモリ最適化**: キャッシュ階層を意識したプログラミング
- **AVX2活用**: 8-way double並列処理
- **並列化**: 32コア/64スレッドの効率的活用
- **性能分析**: プロファイリング・ボトルネック特定

---

## 📞 サポート・コミュニティ

### 🐛 トラブルシューティング
- **Chapter 8**: デバッグガイド
- **GitHub Issues**: 実装上の質問
- **実測データ共有**: 性能結果の比較

### 🤝 貢献方法
- 3970X以外のCPU移植
- 性能測定結果の共有
- 実装改善提案

---

## ⚡ クイックスタート

### 1. 環境確認
```bash
# CPU確認
lscpu | grep "Model name"
# AVX2対応確認  
cat /proc/cpuinfo | grep avx2
```

### 2. 学習パス選択
- 初心者：第1コマから開始
- 実装者：第1-2コマで計画立案
- 完全習得：全4コマ受講

### 3. 実装開始
```bash
git clone [このリポジトリ]
cd tutorial_basics/
make naive_dgemm
./naive_dgemm
```

---

**🚀 1000倍高速化への旅を始めましょう！**

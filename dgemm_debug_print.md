# デバッグしやすいDGEMMの結果のプリント方法

## 1. ソフトウェアの準備

### BLAS と Octave のインストール

以下のようにして、BLAS と Octave をインストールします（Debian/Ubuntu系の例）:

```bash
$ sudo apt update
$ sudo apt install libblas-dev octave
```

- **libblas-dev**: BLAS (Basic Linear Algebra Subprograms) のライブラリを使うための開発用パッケージ  
- **octave**: MATLAB 互換の数値計算ソフトウェア  

---

## 2. テストプログラムのビルドと実行

サンプルコードが置かれている `dgemm_debug_print` ディレクトリに移動し、`make` を実行してビルドします:

```bash
$ cd dgemm_debug_print
$ make
```

ビルドに成功すると、`./dgemm_debug_print` という実行ファイルが生成されます。これを実行すると、以下のように行列 \( A, B, C \) やスカラー \( \alpha, \beta \) がランダムに生成され、その行列と最終的な結果がコンソールに表示されます。実行してみましょう。結果は毎回ランダムなので、

```bash
$ ./dgemm_debug_print
A = [
        7     4     1     7;
        2     9     8     6;
       -1     9    -4    -2;
       -3    -7    -4    -6
];

B = [
       -9     9     1    -8;
        2    -6     0     4;
        2     8    -2     4;
       -7     0     3     3
];

C = [
        3     6     5     7;
       -7    -7     0    -1;
        4     9    -7     8;
        7     0    -7    -2
];

alpha = -5;
beta  = -3;

C_blas = [
      501  -253  -145    54;
      151  -119   -20  -347;
     -177   448    16  -134;
     -256    85    86   196
];

C = alpha * A * B + beta * C; ;
C_blas - C
```

ここでは、行列 \( C_blas \) が “BLAS を使用して計算した結果” として表示され、最後に `C_blas - C` が計算されます。もし両者が完全に一致しているなら、`C_blas - C` はすべて 0 となるはずです。

---

## 3. Octave での動作確認

上の出力をそのまま Octave にコピー＆ペーストすると、計算結果が再現されます。実行例を示します:

```bash
$ ./dgemm_debug_print | octave
ans =

   0   0   0   0
   0   0   0   0
   0   0   0   0
   0   0   0   0
```

ここで表示されている `ans` がゼロ行列になっています。これは、**`C_blas - C` がすべて 0 である → 実装した DGEMM が BLAS での計算結果と一致している** ことを意味します。

---

## 4. 出力を見やすくするポイント

1. **行列を小さめにする**  
   行列のサイズが大きすぎると、コンソールでの確認や Octave 上での可視化が煩雑になります。最初は 4×4 程度で十分です。  

2. **-9 から 9 などの小さい整数範囲で乱数を生成する**  
   テスト用の行列要素を小さな整数にすることで、手計算や目視確認がしやすくなります。  

3. **Octave への貼り付けを想定したフォーマット**  
   乱数生成部分や行列の出力部分を、Octave が理解できる構文（`A = [...]; B = [...]; C = [...];` のように）で表示するようにすると、そのままコピー＆ペーストできて便利です。  

4. **誤差がゼロでなくても微小な浮動小数誤差の場合がある**  
   実際の DGEMM 実装や環境設定によっては、浮動小数点の丸め誤差のために完全に 0 にならず極めて小さな値になる場合があります。例えば、`1.0e-15` 程度の誤差が出ることは自然です。実用レベルでは、  
   \[
     \lVert C_{\text{blas}} - C \rVert \; < \; \text{許容誤差}
   \]
   といった基準を設けて確認する方法もあります。

---

## 5. まとめ

- **DGEMM が正しく動作しているか** を確認するには、
  1. **同一の行列・スカラーを使って**、
  2. **実装した DGEMM と BLAS あるいは他の数値計算ソフトウェア(Octave など) での結果** を比較する  
  という方法がシンプルで確実です。  

- 出力を **Octave 形式で表示** し、**Octave 上でコピペして実際に `C_blas - C` を計算する** と、目で見て誤差がゼロかどうかを確認できます。  

- 本番レベルの実装では大きな行列でも動作しますが、まずは小さな行列サイズで検証し、**誤差が極めて小さいこと** を確認したうえで、徐々に大きな規模にも拡張していくのが良いでしょう。  

このように **テストコードを通じて計算結果を可視化** し、さらに **Octave など他のツールで同じ計算を再現して差分を確認** することで、実装した DGEMM が正しく動作しているかを簡単に検証できます。
